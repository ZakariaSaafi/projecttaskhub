# ğŸš€ ProjectTaskHub - Plateforme de Gestion de Projets et TÃ¢ches

Une plateforme distribuÃ©e basÃ©e sur une architecture microservices pour gÃ©rer des projets et des tÃ¢ches, utilisant Spring Boot, Docker, et des technologies modernes.

## ğŸ—ï¸ Architecture

### Composants Principaux

- **Config Server** (Port 8888) - Configuration centralisÃ©e
- **Discovery Server** (Port 8761) - Service de dÃ©couverte Eureka  
- **API Gateway** (Port 8080) - Passerelle API avec sÃ©curitÃ©
- **Project Service** (Port 8081) - Gestion des projets (PostgreSQL)
- **Task Service** (Port 8082) - Gestion des tÃ¢ches avec CQRS (MongoDB)

### Infrastructure

- **PostgreSQL** - Base de donnÃ©es pour les projets
- **MongoDB** - Base de donnÃ©es pour les tÃ¢ches  
- **RabbitMQ** - Messaging asynchrone
- **Keycloak** - Authentification et autorisation (SSO)

## ğŸš€ Installation et DÃ©marrage

### PrÃ©requis

- Java 17+
- Maven 3.8+
- Docker & Docker Compose
- Git

### Installation Rapide

1. **Cloner le projet**
```bash
git clone <repository-url>
cd projecttaskhub
```

2. **Rendre les scripts exÃ©cutables**
```bash
chmod +x build.sh deploy.sh test-services.sh stop.sh
```

3. **DÃ©ployer l'application**
```bash
./deploy.sh
```

4. **Tester les services**
```bash
./test-services.sh
```

### DÃ©marrage Manuel

1. **Build des services**
```bash
./build.sh
```

2. **DÃ©marrage avec Docker Compose**
```bash
docker-compose up -d
```

## ğŸ”— Points d'AccÃ¨s

| Service | URL | Description |
|---------|-----|-------------|
| API Gateway | http://localhost:8080 | Point d'entrÃ©e principal |
| Discovery Server | http://localhost:8761 | Console Eureka |
| Config Server | http://localhost:8888 | Configuration centralisÃ©e |
| Keycloak Admin | http://localhost:8180/admin | Interface d'administration |
| RabbitMQ Management | http://localhost:15672 | Interface RabbitMQ |

## ğŸ‘¥ Utilisateurs de Test

| Utilisateur | Mot de passe | RÃ´les |
|-------------|--------------|-------|
| admin | admin123 | ADMIN, USER |
| user1 | user123 | USER |

## ğŸ“‹ API Endpoints

### Authentification
Obtenir un token JWT :
```bash
curl -X POST "http://localhost:8180/realms/projecttaskhub/protocol/openid-connect/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=password" \
  -d "client_id=projecttaskhub-api" \
  -d "username=admin" \
  -d "password=admin123"
```

### Projets

- `POST /api/projects` - CrÃ©er un projet
- `GET /api/projects` - Lister tous les projets
- `GET /api/projects/{id}` - Obtenir un projet par ID
- `PUT /api/projects/{id}` - Modifier un projet
- `DELETE /api/projects/{id}` - Supprimer un projet (ADMIN seulement)
- `GET /api/projects/my-projects` - Mes projets
- `GET /api/projects/by-status/{status}` - Projets par statut

### TÃ¢ches

- `POST /api/tasks` - CrÃ©er une tÃ¢che
- `GET /api/tasks` - Lister toutes les tÃ¢ches
- `GET /api/tasks/{id}` - Obtenir une tÃ¢che par ID
- `PUT /api/tasks/{id}` - Modifier une tÃ¢che
- `DELETE /api/tasks/{id}` - Supprimer une tÃ¢che (ADMIN seulement)
- `GET /api/tasks/project/{projectId}` - TÃ¢ches d'un projet
- `GET /api/tasks/my-tasks` - Mes tÃ¢ches
- `GET /api/tasks/by-status/{status}` - TÃ¢ches par statut
- `GET /api/tasks/by-priority/{priority}` - TÃ¢ches par prioritÃ©

## ğŸ”’ SÃ©curitÃ©

L'application utilise Keycloak pour l'authentification et l'autorisation :

- **JWT Tokens** - Authentification basÃ©e sur des tokens
- **RBAC** - ContrÃ´le d'accÃ¨s basÃ© sur les rÃ´les
- **OAuth2/OIDC** - Standards de sÃ©curitÃ© modernes

### RÃ´les

- **USER** - Peut crÃ©er, lire et modifier ses propres projets/tÃ¢ches
- **ADMIN** - AccÃ¨s complet, peut supprimer des Ã©lÃ©ments

## ğŸ”„ Messaging Asynchrone

L'application utilise RabbitMQ pour la communication entre services :

- **Ã‰vÃ©nements Projet** - Notifications de crÃ©ation/modification/suppression
- **Ã‰vÃ©nements TÃ¢che** - Notifications de crÃ©ation/modification/suppression
- **Synchronisation** - Maintien de la cohÃ©rence entre services

## ğŸ“Š Patterns ImplÃ©mentÃ©s

### CQRS (Task Service)
- **Commands** - CreateTaskCommand, UpdateTaskCommand, DeleteTaskCommand
- **Queries** - GetTaskByIdQuery, GetTasksByProjectQuery, etc.
- **Handlers** - SÃ©paration des responsabilitÃ©s lecture/Ã©criture

### API Gateway Pattern
- **Routage** - Redirection vers les services appropriÃ©s
- **SÃ©curitÃ©** - Point d'entrÃ©e sÃ©curisÃ© unique
- **Load Balancing** - RÃ©partition de charge

### Service Discovery
- **Eureka** - Enregistrement et dÃ©couverte automatique des services
- **Health Checks** - Surveillance de l'Ã©tat des services

## ğŸ› ï¸ Technologies UtilisÃ©es

### Backend
- **Spring Boot 3.2** - Framework principal
- **Spring Cloud 2023** - Microservices
- **Spring Security** - SÃ©curitÃ©
- **Spring Data JPA** - Persistance relationnelle
- **Spring Data MongoDB** - Persistance NoSQL
- **MapStruct** - Mapping DTO/Entity

### Infrastructure
- **Docker** - Containerisation
- **PostgreSQL** - Base de donnÃ©es relationnelle
- **MongoDB** - Base de donnÃ©es NoSQL
- **RabbitMQ** - Message broker
- **Keycloak** - Identity Provider

## ğŸ“ Structure du Projet

```
projecttaskhub/
â”œâ”€â”€ config-server/          # Configuration centralisÃ©e
â”œâ”€â”€ discovery-server/       # Service discovery Eureka
â”œâ”€â”€ api-gateway/            # Passerelle API
â”œâ”€â”€ project-service/        # Service gestion projets
â”œâ”€â”€ task-service/           # Service gestion tÃ¢ches (CQRS)
â”œâ”€â”€ shared-dto/             # DTOs partagÃ©s
â”œâ”€â”€ keycloak/              # Configuration Keycloak
â”œâ”€â”€ docker-compose.yml     # Orchestration Docker
â”œâ”€â”€ build.sh              # Script de build
â”œâ”€â”€ deploy.sh             # Script de dÃ©ploiement
â”œâ”€â”€ test-services.sh      # Script de test
â”œâ”€â”€ stop.sh               # Script d'arrÃªt
â””â”€â”€ README.md             # Documentation
```

## ğŸ§ª Tests

### Tests AutomatisÃ©s
```bash
./test-services.sh
```

### Tests Manuels avec curl

**CrÃ©er un projet :**
```bash
curl -X POST "http://localhost:8080/api/projects" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Mon Projet",
    "description": "Description du projet",
    "startDate": "2024-01-01T10:00:00",
    "status": "PLANNING"
  }'
```

**CrÃ©er une tÃ¢che :**
```bash
curl -X POST "http://localhost:8080/api/tasks" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Ma TÃ¢che",
    "description": "Description de la tÃ¢che",
    "projectId": 1,
    "status": "TODO",
    "priority": "MEDIUM"
  }'
```

## ğŸ”§ Configuration

### Variables d'Environnement

Les services peuvent Ãªtre configurÃ©s via des variables d'environnement :

- `SPRING_PROFILES_ACTIVE` - Profil actif (dev, prod)
- `SPRING_CLOUD_CONFIG_URI` - URL du Config Server
- `EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE` - URL Eureka
- `SPRING_DATASOURCE_URL` - URL base de donnÃ©es
- `SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI` - URL Keycloak

### Configuration Multi-Environnement

Le Config Server gÃ¨re les configurations pour diffÃ©rents environnements :
- **dev** - DÃ©veloppement local
- **prod** - Production

## ğŸ› DÃ©pannage

### ProblÃ¨mes Courants

1. **Services ne dÃ©marrent pas**
   - VÃ©rifier que Docker est en cours d'exÃ©cution
   - VÃ©rifier les ports disponibles
   - Consulter les logs : `docker-compose logs <service>`

2. **Erreurs d'authentification**
   - VÃ©rifier que Keycloak est dÃ©marrÃ©
   - VÃ©rifier la configuration du realm
   - RÃ©gÃ©nÃ©rer un token

3. **Erreurs de base de donnÃ©es**
   - VÃ©rifier que PostgreSQL/MongoDB sont accessibles
   - VÃ©rifier les credentials de connexion

### Logs

Consulter les logs des services :
```bash
docker-compose logs -f <service-name>
```

### Health Checks

VÃ©rifier l'Ã©tat des services :
```bash
curl http://localhost:8080/actuator/health
curl http://localhost:8081/actuator/health
curl http://localhost:8082/actuator/health
```

## ğŸ›‘ ArrÃªt des Services

```bash
# ArrÃªt simple
./stop.sh

# ArrÃªt avec suppression des donnÃ©es
./stop.sh --clean
```

## ğŸ¤ Contribution

1. Fork le projet
2. CrÃ©er une branche feature (`git checkout -b feature/AmazingFeature`)
3. Commit les changements (`git commit -m 'Add AmazingFeature'`)
4. Push vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## ğŸ“„ Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de dÃ©tails.

## ğŸ“ Support

Pour toute question ou problÃ¨me :
- CrÃ©er une issue sur GitHub
- Consulter la documentation
- VÃ©rifier les logs des services

---

ğŸ‰ **ProjectTaskHub est maintenant prÃªt Ã  l'emploi !**